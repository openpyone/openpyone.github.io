<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>1A2B ÁåúÊï∏Â≠óÈÅäÊà≤</title>
  <style>
    :root {
      --bg-color: #1c1124;
      --text-color: white;
      --accent-color: #b084dc;
      --button-color: #8e4ad2;
      --button-hover-color: #7124be;
      --input-bg-color: #2a183c;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Consolas, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2em 1em;
      overflow-x: hidden;
    }

    h1 {
      color: var(--accent-color);
      font-size: 2.2rem;
      text-align: center;
      margin-bottom: 0.5em;
    }

    #result-message {
      margin-bottom: 0.5em;
      font-size: 1.5rem;
      color: var(--accent-color);
      text-align: center;
      min-height: 1.8em;
      width: 90%;
      max-width: 400px;
      display: none;
    }

    #history {
      width: 90%;
      max-width: 400px;
      margin: 1em 0;
      display: flex;
      flex-direction: column;
    }

    .guess-row {
      display: flex;
      justify-content: space-between;
      font-size: 1.44rem;
      padding: 0.3em 0.5em;
      border-bottom: 1px solid var(--accent-color);
    }

    #input-container {
      display: flex;
      gap: 0.5em;
      margin-bottom: 1em;
    }

    .digit-box {
      width: 2.5em;
      height: 3em;
      font-size: 1.8rem;
      text-align: center;
      border: 2px solid var(--accent-color);
      border-radius: 10px;
      background-color: var(--input-bg-color);
      color: var(--text-color);
    }

    .btn-group {
      display: flex;
      width: 100%;
      max-width: 400px;
      margin: 0.3em 0;
    }

    .btn-group .btn {
      flex: 1;
      font-size: 1.6rem;
      padding: 0.5em 0;
      border: 1px solid var(--accent-color);
      background-color: var(--button-color);
      color: white;
      cursor: pointer;
      text-align: center;
      border-radius: 0;
      margin-left: -1px;
    }

    .btn-group .btn:first-child {
      border-top-left-radius: 10px;
      border-bottom-left-radius: 10px;
      margin-left: 0;
    }

    .btn-group .btn:last-child {
      border-top-right-radius: 10px;
      border-bottom-right-radius: 10px;
    }

    .btn-group .btn:hover {
      background-color: var(--button-hover-color);
    }

    .btn-func {
      background-color: white;
      color: black;
    }

    .btn-func:hover {
      background-color: var(--accent-color);
      color: white;
    }

    button {
      background-color: var(--button-color);
      color: white;
      border: none;
      padding: 0.7em;
      font-size: 1.2rem;
      border-radius: 10px;
      cursor: pointer;
      margin: 0.5em;
      width: 100%;
      max-width: 400px;
    }

    button:hover {
      background-color: var(--button-hover-color);
    }

    #guess-count {
      margin-top: 0.5em;
      font-size: 1.3rem;
      text-align: center;
      color: var(--accent-color);
    }

    #difficulty-container {
      margin: 0.5em 0;
      display: flex;
      gap: 0.3em;
      width: 100%;
      max-width: 400px;
      justify-content: center;
    }

    #difficulty-container input[type="radio"] {
      display: none;
    }

    .difficulty-btn {
      user-select: none;
      cursor: pointer;
      padding: 0.7em 1.3em;
      border-radius: 10px;
      border: 2px solid var(--button-color);
      background-color: white;
      color: black;
      font-weight: bold;
      font-size: 1.2rem;
      min-width: 180px;
      text-align: center;
      transition: background-color 0.3s, color 0.3s;
    }

    #difficulty-container input[type="radio"]:checked + label {
      background-color: var(--button-color);
      color: white;
    }

    #modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #modal {
      background: var(--bg-color);
      border: 2px solid var(--accent-color);
      border-radius: 12px;
      padding: 1.5em 2em;
      max-width: 90%;
      color: var(--text-color);
      font-size: 1.44rem;
      text-align: center;
      box-shadow: 0 0 15px var(--accent-color);
    }

    @media (max-width: 480px) {
      body {
        padding: 1em 0.5em;
      }
      .digit-box {
        font-size: 1.44rem;
        width: 2em;
        height: 2.5em;
      }
      .difficulty-btn {
        min-width: 140px;
        font-size: 1.5rem;
      }
      button {
        font-size: 1.5rem;
        max-width: 100%;
      }
      #modal {
        font-size: 1.3rem;
        padding: 1em 1.5em;
      }
    }
  </style>
</head>
<body>
  <h1 id="title">1A2B ÁåúÊï∏Â≠óÈÅäÊà≤</h1>
  <div id="result-message"></div>
  <div id="history"></div>

  <div id="input-container">
    <input class="digit-box" maxlength="1" inputmode="none" readonly />
    <input class="digit-box" maxlength="1" inputmode="none" readonly />
    <input class="digit-box" maxlength="1" inputmode="none" readonly />
    <input class="digit-box" maxlength="1" inputmode="none" readonly />
  </div>

  <div class="btn-group">
    <button class="btn" data-digit="0">0</button>
    <button class="btn" data-digit="1">1</button>
    <button class="btn" data-digit="2">2</button>
    <button class="btn" data-digit="3">3</button>
    <button class="btn" data-digit="4">4</button>
    <button class="btn btn-func" id="clear-btn">X</button>
  </div>

  <div class="btn-group">
    <button class="btn" data-digit="5">5</button>
    <button class="btn" data-digit="6">6</button>
    <button class="btn" data-digit="7">7</button>
    <button class="btn" data-digit="8">8</button>
    <button class="btn" data-digit="9">9</button>
    <button class="btn btn-func" id="backspace-btn"><</button>
  </div>

  <button onclick="submitGuess()" id="submit-btn">Êèê‰∫§ÁåúÊ∏¨</button>
  <button onclick="restartGame()" id="restart-btn">ÈáçÊñ∞ÈñãÂßã</button>

  <div id="difficulty-container">
    <input type="radio" id="easy" name="difficulty" value="easy" checked>
    <label for="easy" class="difficulty-btn">ÂÆπÊòì</label>

    <input type="radio" id="hard" name="difficulty" value="hard">
    <label for="hard" class="difficulty-btn">Âõ∞Èõ£</label>
  </div>

  <button onclick="toggleLanguage()" id="lang-btn">English</button>
  <div id="guess-count">ÁåúÊ∏¨Ê¨°Êï∏Ôºö0</div>

  <div id="modal-overlay" onclick="closeModal()">
    <div id="modal">
      <div id="modal-message"></div>
    </div>
  </div>

  <script>
    const inputs = document.querySelectorAll('.digit-box');
    const history = document.getElementById('history');
    const resultMessage = document.getElementById('result-message');
    const guessCountDisplay = document.getElementById('guess-count');
    const modalOverlay = document.getElementById('modal-overlay');
    const modalMessage = document.getElementById('modal-message');
    const langBtn = document.getElementById('lang-btn');

    let answer = [];
    let currentInput = 0;
    let guessCount = 0;
    let lang = 'zh';
    let gameOver = false;

    const i18n = {
      zh: {
        title: "1A2B ÁåúÊï∏Â≠óÈÅäÊà≤",
        restart: "ÈáçÊñ∞ÈñãÂßã",
        submit: "Êèê‰∫§ÁåúÊ∏¨",
        easy: "ÂÆπÊòì",
        hard: "Âõ∞Èõ£",
        guesses: "ÁåúÊ∏¨Ê¨°Êï∏Ôºö",
        great: "ÊÅ≠ÂñúÁ≠îÂ∞ç‰∫ÜÔºÅ",
        langBtn: "English"
      },
      en: {
        title: "1A2B Number Guessing",
        restart: "Restart",
        submit: "Submit Guess",
        easy: "Easy",
        hard: "Hard",
        guesses: "Guesses: ",
        great: "Great!",
        langBtn: "‰∏≠Êñá"
      }
    };

    function generateAnswer() {
      const mode = document.querySelector('input[name="difficulty"]:checked').value;
      const digits = [];
      while (digits.length < 4) {
        const n = Math.floor(Math.random() * 10);
        if (mode === 'easy' && digits.includes(n)) continue;
        digits.push(n);
      }
      return digits;
    }

    function updateGuessCount() {
      guessCountDisplay.textContent = i18n[lang].guesses + guessCount;
    }

    function restartGame() {
      answer = generateAnswer();
      console.log("üîç Á≠îÊ°àÊòØ:", answer.join(""));
      inputs.forEach(input => {
        input.value = "";
        input.disabled = false;
      });
      resultMessage.textContent = "";
      resultMessage.style.display = "none";
      history.innerHTML = "";
      guessCount = 0;
      gameOver = false;
      currentInput = 0;
      inputs[0].focus();
      updateGuessCount();
    }

    function checkAB(guess) {
      let A = 0, B = 0;
      for (let i = 0; i < 4; i++) {
        if (guess[i] === answer[i]) A++;
        else if (answer.includes(guess[i])) B++;
      }
      return `${A}A${B}B`;
    }

    function submitGuess() {
      if (gameOver) return;

      const guess = Array.from(inputs).map(input => parseInt(input.value));
      if (guess.some(isNaN)) return;

      const result = checkAB(guess);
      guessCount++;
      updateGuessCount();

      const row = document.createElement('div');
      row.className = 'guess-row';
      row.innerHTML = `<span>${guess.join("")}</span><span>${result}</span>`;
      history.appendChild(row);
      history.scrollTop = history.scrollHeight;

      if (result === "4A0B") {
        resultMessage.textContent = i18n[lang].great;
        resultMessage.style.display = "block";
        showModal(i18n[lang].great);
        inputs.forEach(input => input.disabled = true);
        gameOver = true;
      } else {
        inputs.forEach(input => input.value = "");
        currentInput = 0;
        inputs[0].focus();
      }
    }

    function showModal(msg) {
      modalMessage.textContent = msg;
      modalOverlay.style.display = "flex";
    }

    function closeModal() {
      modalOverlay.style.display = "none";
    }

    function toggleLanguage() {
      lang = lang === "zh" ? "en" : "zh";
      document.getElementById('title').textContent = i18n[lang].title;
      document.getElementById('submit-btn').textContent = i18n[lang].submit;
      document.getElementById('restart-btn').textContent = i18n[lang].restart;
      document.querySelector('label[for="easy"]').textContent = i18n[lang].easy;
      document.querySelector('label[for="hard"]').textContent = i18n[lang].hard;
      langBtn.textContent = i18n[lang].langBtn;
      updateGuessCount();
      if (gameOver) resultMessage.textContent = i18n[lang].great;
    }

    function handleDigitInput(digit) {
      if (gameOver) return;
      if (currentInput < 4) {
        inputs[currentInput].value = digit;
        currentInput++;
        if (currentInput < 4) {
          inputs[currentInput].focus();
        }
      }
    }

    function clearInputs() {
      inputs.forEach(input => input.value = "");
      currentInput = 0;
      inputs[0].focus();
    }

    function backspace() {
      if (currentInput > 0) {
        currentInput--;
        inputs[currentInput].value = "";
        inputs[currentInput].focus();
      }
    }

    document.querySelectorAll('[data-digit]').forEach(btn => {
      btn.addEventListener('click', () => {
        handleDigitInput(btn.dataset.digit);
      });
    });

    document.getElementById('clear-btn').addEventListener('click', clearInputs);
    document.getElementById('backspace-btn').addEventListener('click', backspace);

    inputs.forEach((input) => {
      input.addEventListener('focus', () => {
        input.select();
      });
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === "Enter" && !gameOver) {
        if (Array.from(inputs).every(input => input.value !== "")) {
          submitGuess();
        }
      }
    });

    document.querySelectorAll('input[name="difficulty"]').forEach(radio => {
      radio.addEventListener('change', restartGame);
    });

    window.onload = restartGame;
  </script>
</body>
</html>
